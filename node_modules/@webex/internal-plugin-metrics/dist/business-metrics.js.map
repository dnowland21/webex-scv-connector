{"version":3,"names":["_genericMetrics","_interopRequireDefault","require","ownKeys","e","r","t","_Object$keys","_Object$getOwnPropertySymbols","o","filter","_Object$getOwnPropertyDescriptor","enumerable","push","apply","_objectSpread","arguments","length","Object","forEach","_defineProperty2","default","_Object$getOwnPropertyDescriptors","_Object$defineProperties","_Object$defineProperty","_createSuper","Derived","hasNativeReflectConstruct","_isNativeReflectConstruct","_createSuperInternal","Super","_getPrototypeOf2","result","NewTarget","constructor","_Reflect$construct","_possibleConstructorReturn2","Reflect","sham","Proxy","Boolean","prototype","valueOf","call","BusinessMetrics","exports","_GenericMetrics","_inherits2","_super","_classCallCheck2","_createClass2","key","value","buildEvent","_ref","name","payload","metadata","type","eventPayload","client_timestamp","Date","toISOString","submitBusinessEvent","_ref2","table","appType","callEndEvent","submitEvent","kind","event","businessEvent","getContext","getBrowserDetails","defaultEvent","context","browserDetails","GenericMetrics"],"sources":["business-metrics.ts"],"sourcesContent":["import GenericMetrics from './generic-metrics';\nimport {EventPayload, Table} from './metrics.types';\n\n/**\n * @description Util class to handle Business Metrics\n * @export\n * @class BusinessMetrics\n */\nexport default class BusinessMetrics extends GenericMetrics {\n  /**\n   * Build the metric event to submit.\n   * @param {string} name of the metric\n   * @param {EventPayload} payload user payload of the metric\n   * @param {EventPayload} metadata to include outside of eventPayload.value\n   * @returns {MetricEvent} The constructed metric event\n   */\n  private buildEvent({name, payload, metadata}: {name: string; payload: object; metadata: object}) {\n    return {\n      type: ['business'],\n      eventPayload: {\n        key: name,\n        client_timestamp: new Date().toISOString(),\n        ...metadata,\n        value: payload,\n      },\n    };\n  }\n\n  /**\n   * Submit a business metric to our metrics endpoint.\n   * routes to the correct table with the correct schema payload by table\n   * https://confluence-eng-gpk2.cisco.com/conf/display/WAP/Business+metrics++-%3E+ROMA\n   * @param {string} name of the metric, ignored if going to wbxapp_callend_metrics\n   * @param {EventPayload} payload user payload of the metric\n   * @param {Table} table optional - to submit the metric to and adapt the sent schema\n   * @param {EventPayload} metadata optional - to include outside of eventPayload.value\n   * @returns {Promise<any>}\n   */\n  public submitBusinessEvent({\n    name,\n    payload,\n    table,\n    metadata,\n  }: {\n    name: string;\n    payload: EventPayload;\n    table?: Table;\n    metadata?: EventPayload;\n  }): Promise<void> {\n    if (!table) {\n      table = 'default';\n    }\n    if (!metadata) {\n      metadata = {};\n    }\n    if (!metadata.appType) {\n      metadata.appType = 'Web Client';\n    }\n    switch (table) {\n      case 'wbxapp_callend_metrics': {\n        // https://confluence-eng-gpk2.cisco.com/conf/display/WAP/Table+wbxapp_callend_metrics\n        const callEndEvent = this.buildEvent({name: 'callEnd', payload, metadata});\n\n        return this.submitEvent({\n          kind: 'business-events:wbxapp_callend_metrics -> ',\n          name: 'wbxapp_callend_metrics',\n          event: callEndEvent,\n        });\n      }\n\n      case 'business_metrics': {\n        // all event payload keys are converted into a hex string value\n        // unfortunately, the pinot team does not allow changes to the schema of business_metrics\n        // so we have to shim this layer specifically for this\n        // https://confluence-eng-gpk2.cisco.com/conf/display/WAP/Table%3A+business_metrics\n        const businessEvent = this.buildEvent({\n          name,\n          payload: {\n            ...this.getContext(),\n            ...this.getBrowserDetails(),\n            ...payload,\n          },\n          metadata,\n        });\n\n        return this.submitEvent({\n          kind: 'business-events:business_metrics -> ',\n          name,\n          event: businessEvent,\n        });\n      }\n\n      case 'business_ucf':\n      case 'default':\n      default: {\n        // all event payload keys are converted into a hex string value\n        // https://confluence-eng-gpk2.cisco.com/conf/display/WAP/Business+metrics++-%3E+ROMA\n        const defaultEvent = this.buildEvent({\n          name,\n          payload,\n          metadata: {\n            context: this.getContext(),\n            browserDetails: this.getBrowserDetails(),\n            ...metadata,\n          },\n        });\n\n        return this.submitEvent({kind: 'business-events:default -> ', name, event: defaultEvent});\n      }\n    }\n  }\n}\n"],"mappings":";;;;;;;;;;;;;;;;;;;;AAAA,IAAAA,eAAA,GAAAC,sBAAA,CAAAC,OAAA;AAA+C,SAAAC,QAAAC,CAAA,EAAAC,CAAA,QAAAC,CAAA,GAAAC,YAAA,CAAAH,CAAA,OAAAI,6BAAA,QAAAC,CAAA,GAAAD,6BAAA,CAAAJ,CAAA,GAAAC,CAAA,KAAAI,CAAA,GAAAA,CAAA,CAAAC,MAAA,WAAAL,CAAA,WAAAM,gCAAA,CAAAP,CAAA,EAAAC,CAAA,EAAAO,UAAA,OAAAN,CAAA,CAAAO,IAAA,CAAAC,KAAA,CAAAR,CAAA,EAAAG,CAAA,YAAAH,CAAA;AAAA,SAAAS,cAAAX,CAAA,aAAAC,CAAA,MAAAA,CAAA,GAAAW,SAAA,CAAAC,MAAA,EAAAZ,CAAA,UAAAC,CAAA,WAAAU,SAAA,CAAAX,CAAA,IAAAW,SAAA,CAAAX,CAAA,QAAAA,CAAA,OAAAF,OAAA,CAAAe,MAAA,CAAAZ,CAAA,OAAAa,OAAA,WAAAd,CAAA,QAAAe,gBAAA,CAAAC,OAAA,EAAAjB,CAAA,EAAAC,CAAA,EAAAC,CAAA,CAAAD,CAAA,SAAAiB,iCAAA,GAAAC,wBAAA,CAAAnB,CAAA,EAAAkB,iCAAA,CAAAhB,CAAA,KAAAH,OAAA,CAAAe,MAAA,CAAAZ,CAAA,GAAAa,OAAA,WAAAd,CAAA,IAAAmB,sBAAA,CAAApB,CAAA,EAAAC,CAAA,EAAAM,gCAAA,CAAAL,CAAA,EAAAD,CAAA,iBAAAD,CAAA;AAAA,SAAAqB,aAAAC,OAAA,QAAAC,yBAAA,GAAAC,yBAAA,oBAAAC,qBAAA,QAAAC,KAAA,OAAAC,gBAAA,CAAAV,OAAA,EAAAK,OAAA,GAAAM,MAAA,MAAAL,yBAAA,QAAAM,SAAA,OAAAF,gBAAA,CAAAV,OAAA,QAAAa,WAAA,EAAAF,MAAA,GAAAG,kBAAA,CAAAL,KAAA,EAAAd,SAAA,EAAAiB,SAAA,YAAAD,MAAA,GAAAF,KAAA,CAAAhB,KAAA,OAAAE,SAAA,gBAAAoB,2BAAA,CAAAf,OAAA,QAAAW,MAAA;AAAA,SAAAJ,0BAAA,eAAAS,OAAA,qBAAAF,kBAAA,oBAAAA,kBAAA,CAAAG,IAAA,2BAAAC,KAAA,oCAAAC,OAAA,CAAAC,SAAA,CAAAC,OAAA,CAAAC,IAAA,CAAAR,kBAAA,CAAAK,OAAA,8CAAApC,CAAA;AAG/C;AACA;AACA;AACA;AACA;AAJA,IAKqBwC,eAAe,GAAAC,OAAA,CAAAxB,OAAA,0BAAAyB,eAAA;EAAA,IAAAC,UAAA,CAAA1B,OAAA,EAAAuB,eAAA,EAAAE,eAAA;EAAA,IAAAE,MAAA,GAAAvB,YAAA,CAAAmB,eAAA;EAAA,SAAAA,gBAAA;IAAA,IAAAK,gBAAA,CAAA5B,OAAA,QAAAuB,eAAA;IAAA,OAAAI,MAAA,CAAAlC,KAAA,OAAAE,SAAA;EAAA;EAAA,IAAAkC,aAAA,CAAA7B,OAAA,EAAAuB,eAAA;IAAAO,GAAA;IAAAC,KAAA;IAClC;AACF;AACA;AACA;AACA;AACA;AACA;IACE,SAAAC,WAAAC,IAAA,EAAiG;MAAA,IAA7EC,IAAI,GAAAD,IAAA,CAAJC,IAAI;QAAEC,OAAO,GAAAF,IAAA,CAAPE,OAAO;QAAEC,QAAQ,GAAAH,IAAA,CAARG,QAAQ;MACzC,OAAO;QACLC,IAAI,EAAE,CAAC,UAAU,CAAC;QAClBC,YAAY,EAAA5C,aAAA,CAAAA,aAAA;UACVoC,GAAG,EAAEI,IAAI;UACTK,gBAAgB,EAAE,IAAIC,IAAI,CAAC,CAAC,CAACC,WAAW,CAAC;QAAC,GACvCL,QAAQ;UACXL,KAAK,EAAEI;QAAO;MAElB,CAAC;IACH;;IAEA;AACF;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;EATE;IAAAL,GAAA;IAAAC,KAAA,EAUA,SAAAW,oBAAAC,KAAA,EAUkB;MAAA,IAThBT,IAAI,GAAAS,KAAA,CAAJT,IAAI;QACJC,OAAO,GAAAQ,KAAA,CAAPR,OAAO;QACPS,KAAK,GAAAD,KAAA,CAALC,KAAK;QACLR,QAAQ,GAAAO,KAAA,CAARP,QAAQ;MAOR,IAAI,CAACQ,KAAK,EAAE;QACVA,KAAK,GAAG,SAAS;MACnB;MACA,IAAI,CAACR,QAAQ,EAAE;QACbA,QAAQ,GAAG,CAAC,CAAC;MACf;MACA,IAAI,CAACA,QAAQ,CAACS,OAAO,EAAE;QACrBT,QAAQ,CAACS,OAAO,GAAG,YAAY;MACjC;MACA,QAAQD,KAAK;QACX,KAAK,wBAAwB;UAAE;YAC7B;YACA,IAAME,YAAY,GAAG,IAAI,CAACd,UAAU,CAAC;cAACE,IAAI,EAAE,SAAS;cAAEC,OAAO,EAAPA,OAAO;cAAEC,QAAQ,EAARA;YAAQ,CAAC,CAAC;YAE1E,OAAO,IAAI,CAACW,WAAW,CAAC;cACtBC,IAAI,EAAE,4CAA4C;cAClDd,IAAI,EAAE,wBAAwB;cAC9Be,KAAK,EAAEH;YACT,CAAC,CAAC;UACJ;QAEA,KAAK,kBAAkB;UAAE;YACvB;YACA;YACA;YACA;YACA,IAAMI,aAAa,GAAG,IAAI,CAAClB,UAAU,CAAC;cACpCE,IAAI,EAAJA,IAAI;cACJC,OAAO,EAAAzC,aAAA,CAAAA,aAAA,CAAAA,aAAA,KACF,IAAI,CAACyD,UAAU,CAAC,CAAC,GACjB,IAAI,CAACC,iBAAiB,CAAC,CAAC,GACxBjB,OAAO,CACX;cACDC,QAAQ,EAARA;YACF,CAAC,CAAC;YAEF,OAAO,IAAI,CAACW,WAAW,CAAC;cACtBC,IAAI,EAAE,sCAAsC;cAC5Cd,IAAI,EAAJA,IAAI;cACJe,KAAK,EAAEC;YACT,CAAC,CAAC;UACJ;QAEA,KAAK,cAAc;QACnB,KAAK,SAAS;QACd;UAAS;YACP;YACA;YACA,IAAMG,YAAY,GAAG,IAAI,CAACrB,UAAU,CAAC;cACnCE,IAAI,EAAJA,IAAI;cACJC,OAAO,EAAPA,OAAO;cACPC,QAAQ,EAAA1C,aAAA;gBACN4D,OAAO,EAAE,IAAI,CAACH,UAAU,CAAC,CAAC;gBAC1BI,cAAc,EAAE,IAAI,CAACH,iBAAiB,CAAC;cAAC,GACrChB,QAAQ;YAEf,CAAC,CAAC;YAEF,OAAO,IAAI,CAACW,WAAW,CAAC;cAACC,IAAI,EAAE,6BAA6B;cAAEd,IAAI,EAAJA,IAAI;cAAEe,KAAK,EAAEI;YAAY,CAAC,CAAC;UAC3F;MACF;IACF;EAAC;EAAA,OAAA9B,eAAA;AAAA,EAtG0CiC,uBAAc"}