{"version":3,"names":["_ipAnonymize","_interopRequireDefault","require","_util","_common","_webexCore","_lodash","_config","_BrowserDetection","BrowserDetection","getOSName","getOSVersion","getBrowserName","getBrowserVersion","anonymizeIPAddress","exports","localIp","anonymize","userAgentToString","_ref","clientName","webexVersion","userAgentOption","browserInfo","clientInfo","util","format","concat","indexOf","toLowerCase","split","osInfo","process","env","NODE_ENV","clearEmptyKeysRecursively","obj","_keys","default","length","forEach","key","_typeof2","_isArray","isEmpty","_toConsumableArray2","filter","x","isLocusServiceErrorCode","errorCode","code","charAt","isMeetingInfoServiceError","rawError","_rawError$body","_rawError$body$data","_rawError$body2","_rawError$body2$url","body","data","meetingInfo","url","includes","WBX_APP_API_URL","isNetworkError","WebexHttpError","NetworkOrCORSError","isUnauthorizedError","Unauthorized","isSdpOfferCreationError","name","ERROR_DESCRIPTIONS","SDP_OFFER_CREATION_ERROR","isBrowserMediaErrorName","errorName","BROWSER_MEDIA_ERROR_NAME_TO_CLIENT_ERROR_CODES_MAP","getBuildType","webex","webClientDomain","_webex$internal$metri","_webex$internal$metri2","markAsTestEvent","arguments","undefined","internal","metrics","config","caBuildType","prepareDiagnosticMetricItem","item","_item$eventPayload","_item$eventPayload$ev","_item$eventPayload$ev2","_item$eventPayload2","_item$eventPayload2$e","_item$eventPayload2$e2","_item$eventPayload3","_item$eventPayload3$e","buildType","eventPayload","event","eventData","upgradeChannel","origin","networkType","eventName","joinTimes","audioSetupDelay","videoSetupDelay","cdl","newMetrics","callDiagnosticLatencies","downloadTime","getDownloadTimeJMT","otherAppApiReqResp","getOtherAppApiReqResp","exchangeCITokenJMT","getExchangeCITokenJMT","meetingInfoReqResp","getMeetingInfoReqResp","clickToInterstitial","getClickToInterstitial","refreshCaptchaServiceReqResp","getRefreshCaptchaReqResp","downloadIntelligenceModelsReqResp","getDownloadIntelligenceModelsReqResp","showInterstitialTime","getShowInterstitialTime","registerWDMDeviceJMT","getRegisterWDMDeviceJMT","getU2CTime","getReachabilityClustersReqResp","callInitJoinReq","getCallInitJoinReq","joinReqResp","getJoinReqResp","pageJmt","getPageJMT","interstitialToJoinOK","getInterstitialToJoinOK","totalJmt","getTotalJMT","clientJmt","getClientJMT","ICESetupTime","getICESetupTime","audioICESetupTime","getAudioICESetupTime","videoICESetupTime","getVideoICESetupTime","shareICESetupTime","getShareICESetupTime","localSDPGenRemoteSDPRecv","getLocalSDPGenRemoteSDPRecv","joinRespRxStart","getAudioJoinRespRxStart","getVideoJoinRespRxStart","totalMediaJMT","getTotalMediaJMT","interstitialToMediaOKJMT","getInterstitialToMediaOKJMT","callInitMediaEngineReady","getCallInitMediaEngineReady","stayLobbyTime","getStayLobbyTime","joinRespTxStart","getAudioJoinRespTxStart","getVideoJoinRespTxStart","merge","_assign","logger","log","_stringify","latencies","Object","fromEntries","latencyTimestamps","setMetricTimings","options","json","_body$metrics","JSON","parse","now","Date","toISOString","metric","originTime","triggered","sent","extractVersionMetadata","version","_version$split","_version$split2","_slicedToArray2","majorVersion","minorVersion","_parseInt2","generateClientErrorCodeForIceFailure","_ref2","signalingState","iceConnected","turnServerUsed","unreachable","ICE_FAILURE_CLIENT_CODE","MISSING_ROAP_ANSWER_CLIENT_CODE","DTLS_HANDSHAKE_FAILED_CLIENT_CODE","ICE_AND_REACHABILITY_FAILED_CLIENT_CODE","ICE_FAILED_WITH_TURN_TLS_CLIENT_CODE","ICE_FAILED_WITHOUT_TURN_TLS_CLIENT_CODE"],"sources":["call-diagnostic-metrics.util.ts"],"sourcesContent":["/* eslint-disable valid-jsdoc */\nimport anonymize from 'ip-anonymize';\nimport util from 'util';\n\nimport {BrowserDetection} from '@webex/common';\nimport {WebexHttpError} from '@webex/webex-core';\nimport {isEmpty, merge} from 'lodash';\nimport {\n  ClientEvent,\n  Event,\n  MediaQualityEventAudioSetupDelayPayload,\n  MediaQualityEventVideoSetupDelayPayload,\n  MetricEventNames,\n} from '../metrics.types';\nimport {\n  BROWSER_MEDIA_ERROR_NAME_TO_CLIENT_ERROR_CODES_MAP,\n  DTLS_HANDSHAKE_FAILED_CLIENT_CODE,\n  ICE_FAILED_WITHOUT_TURN_TLS_CLIENT_CODE,\n  ICE_FAILED_WITH_TURN_TLS_CLIENT_CODE,\n  ICE_FAILURE_CLIENT_CODE,\n  MISSING_ROAP_ANSWER_CLIENT_CODE,\n  WBX_APP_API_URL,\n  ERROR_DESCRIPTIONS,\n  ICE_AND_REACHABILITY_FAILED_CLIENT_CODE,\n} from './config';\n\nconst {getOSName, getOSVersion, getBrowserName, getBrowserVersion} = BrowserDetection();\n\nexport const anonymizeIPAddress = (localIp) => anonymize(localIp, 28, 96);\n\n/**\n * Returns a formated string of the user agent.\n *\n * @returns {string} formatted user agent information\n */\nexport const userAgentToString = ({clientName, webexVersion}) => {\n  let userAgentOption;\n  let browserInfo;\n  const clientInfo = util.format('client=%s', `${clientName}`);\n\n  if (\n    ['chrome', 'firefox', 'msie', 'msedge', 'safari'].indexOf(getBrowserName().toLowerCase()) !== -1\n  ) {\n    browserInfo = util.format(\n      'browser=%s',\n      `${getBrowserName().toLowerCase()}/${getBrowserVersion().split('.')[0]}`\n    );\n  }\n  const osInfo = util.format('os=%s', `${getOSName()}/${getOSVersion().split('.')[0]}`);\n\n  if (browserInfo) {\n    userAgentOption = `(${browserInfo}`;\n  }\n  if (osInfo) {\n    userAgentOption = userAgentOption\n      ? `${userAgentOption}; ${clientInfo}; ${osInfo}`\n      : `${clientInfo}; (${osInfo}`;\n  }\n  if (userAgentOption) {\n    userAgentOption += ')';\n\n    return util.format(\n      'webex-js-sdk/%s %s',\n      `${process.env.NODE_ENV}-${webexVersion}`,\n      userAgentOption\n    );\n  }\n\n  return util.format('webex-js-sdk/%s', `${process.env.NODE_ENV}-${webexVersion}`);\n};\n\n/**\n * Iterates object recursively and removes any\n * property that returns isEmpty for it's associated value\n * isEmpty = implementation from Lodash.\n *\n * It modifies the object in place (mutable)\n *\n * @param obj - input\n * @returns\n */\nexport const clearEmptyKeysRecursively = (obj: any) => {\n  // Check if the object is empty\n  if (Object.keys(obj).length === 0) {\n    return;\n  }\n\n  Object.keys(obj).forEach((key) => {\n    if (\n      (typeof obj[key] === 'object' || typeof obj[key] === 'string' || Array.isArray(obj[key])) &&\n      isEmpty(obj[key])\n    ) {\n      delete obj[key];\n    }\n    if (Array.isArray(obj[key])) {\n      obj[key] = [...obj[key].filter((x) => !!x)];\n    }\n    if (typeof obj[key] === 'object') {\n      clearEmptyKeysRecursively(obj[key]);\n    }\n  });\n};\n\n/**\n * Locus error codes start with 2. The next three digits are the\n * HTTP status code related to the error code (like 400, 403, 502, etc.)\n * The remaining three digits are just an increasing integer.\n * If it is 7 digits and starts with a 2, it is locus.\n *\n * @param errorCode\n * @returns {boolean}\n */\nexport const isLocusServiceErrorCode = (errorCode: string | number) => {\n  const code = `${errorCode}`;\n\n  if (code.length === 7 && code.charAt(0) === '2') {\n    return true;\n  }\n\n  return false;\n};\n\n/**\n * MeetingInfo errors sometimes has body.data.meetingInfo object\n * MeetingInfo errors come with a wbxappapi url\n *\n * @param {Object} rawError\n * @returns {boolean}\n */\nexport const isMeetingInfoServiceError = (rawError: any) => {\n  if (rawError.body?.data?.meetingInfo || rawError.body?.url?.includes(WBX_APP_API_URL)) {\n    return true;\n  }\n\n  return false;\n};\n\n/**\n * Returns true if the raw error is a network related error\n *\n * @param {Object} rawError\n * @returns {boolean}\n */\nexport const isNetworkError = (rawError: any) => {\n  if (rawError instanceof WebexHttpError.NetworkOrCORSError) {\n    return true;\n  }\n\n  return false;\n};\n\n/**\n * Returns true if the error is an unauthorized error\n *\n * @param {Object} rawError\n * @returns {boolean}\n */\nexport const isUnauthorizedError = (rawError: any) => {\n  if (rawError instanceof WebexHttpError.Unauthorized) {\n    return true;\n  }\n\n  return false;\n};\n\n/**\n * Returns true if the error is an SdpOfferCreation error\n *\n * @param {Object} rawError\n * @returns {boolean}\n */\nexport const isSdpOfferCreationError = (rawError: any) => {\n  // would LIKE to do rawError instanceof Errors.SdpOfferCreationError\n  // but including internal-media-core in plugin-metrics breaks meetings and metrics unit tests\n  if (rawError.name === ERROR_DESCRIPTIONS.SDP_OFFER_CREATION_ERROR) {\n    return true;\n  }\n\n  return false;\n};\n\n/**\n * MDN Media Devices getUserMedia() method returns a name if it errs\n * Documentation can be found here: https://developer.mozilla.org/en-US/docs/Web/API/MediaDevices/getUserMedia\n *\n * @param errorCode\n * @returns\n */\nexport const isBrowserMediaErrorName = (errorName: any) => {\n  if (BROWSER_MEDIA_ERROR_NAME_TO_CLIENT_ERROR_CODES_MAP[errorName]) {\n    return true;\n  }\n\n  return false;\n};\n\n/**\n * @param {Object} webex sdk instance\n * @param webClientDomain\n * @returns\n */\nexport const getBuildType = (\n  webex,\n  webClientDomain,\n  markAsTestEvent = false\n): Event['origin']['buildType'] => {\n  // used temporary to test pre join in production without creating noise data, SPARK-468456\n  if (markAsTestEvent) {\n    return 'test';\n  }\n\n  if (webex.internal.metrics?.config?.caBuildType) {\n    return webex.internal.metrics.config.caBuildType;\n  }\n\n  if (\n    webClientDomain?.includes('localhost') ||\n    webClientDomain?.includes('127.0.0.1') ||\n    process.env.NODE_ENV !== 'production'\n  ) {\n    return 'test';\n  }\n\n  return 'prod';\n};\n\n/**\n * Prepare metric item for submission.\n * @param {Object} webex sdk instance\n * @param {Object} item\n * @returns {Object} prepared item\n */\nexport const prepareDiagnosticMetricItem = (webex: any, item: any) => {\n  const buildType = getBuildType(\n    webex,\n    item.eventPayload?.event?.eventData?.webClientDomain,\n    item.eventPayload?.event?.eventData?.markAsTestEvent\n  );\n\n  // Set upgradeChannel to 'gold' if buildType is 'prod', otherwise to the buildType value\n  const upgradeChannel = buildType === 'prod' ? 'gold' : buildType;\n\n  const origin: Partial<Event['origin']> = {\n    buildType,\n    networkType: 'unknown',\n    upgradeChannel,\n  };\n\n  // check event names and append latencies?\n  const eventName = item.eventPayload?.event?.name as MetricEventNames;\n  const joinTimes: ClientEvent['payload']['joinTimes'] = {};\n  const audioSetupDelay: MediaQualityEventAudioSetupDelayPayload = {};\n  const videoSetupDelay: MediaQualityEventVideoSetupDelayPayload = {};\n\n  const cdl = webex.internal.newMetrics.callDiagnosticLatencies;\n\n  switch (eventName) {\n    case 'client.webexapp.launched':\n      joinTimes.downloadTime = cdl.getDownloadTimeJMT();\n      break;\n    case 'client.login.end':\n      joinTimes.otherAppApiReqResp = cdl.getOtherAppApiReqResp();\n      joinTimes.exchangeCITokenJMT = cdl.getExchangeCITokenJMT();\n      break;\n    case 'client.interstitial-window.launched':\n      joinTimes.meetingInfoReqResp = cdl.getMeetingInfoReqResp();\n      joinTimes.clickToInterstitial = cdl.getClickToInterstitial();\n      joinTimes.refreshCaptchaServiceReqResp = cdl.getRefreshCaptchaReqResp();\n      joinTimes.downloadIntelligenceModelsReqResp = cdl.getDownloadIntelligenceModelsReqResp();\n      break;\n\n    case 'client.call.initiated':\n      joinTimes.meetingInfoReqResp = cdl.getMeetingInfoReqResp();\n      joinTimes.showInterstitialTime = cdl.getShowInterstitialTime();\n      joinTimes.registerWDMDeviceJMT = cdl.getRegisterWDMDeviceJMT();\n      joinTimes.getU2CTime = cdl.getU2CTime();\n      joinTimes.getReachabilityClustersReqResp = cdl.getReachabilityClustersReqResp();\n      break;\n\n    case 'client.locus.join.response':\n      joinTimes.meetingInfoReqResp = cdl.getMeetingInfoReqResp();\n      joinTimes.callInitJoinReq = cdl.getCallInitJoinReq();\n      joinTimes.joinReqResp = cdl.getJoinReqResp();\n      joinTimes.pageJmt = cdl.getPageJMT();\n      joinTimes.clickToInterstitial = cdl.getClickToInterstitial();\n      joinTimes.interstitialToJoinOK = cdl.getInterstitialToJoinOK();\n      joinTimes.totalJmt = cdl.getTotalJMT();\n      joinTimes.clientJmt = cdl.getClientJMT();\n      joinTimes.downloadTime = cdl.getDownloadTimeJMT();\n      break;\n\n    case 'client.ice.end':\n      joinTimes.ICESetupTime = cdl.getICESetupTime();\n      joinTimes.audioICESetupTime = cdl.getAudioICESetupTime();\n      joinTimes.videoICESetupTime = cdl.getVideoICESetupTime();\n      joinTimes.shareICESetupTime = cdl.getShareICESetupTime();\n      break;\n\n    case 'client.media.rx.start':\n      joinTimes.localSDPGenRemoteSDPRecv = cdl.getLocalSDPGenRemoteSDPRecv();\n      audioSetupDelay.joinRespRxStart = cdl.getAudioJoinRespRxStart();\n      videoSetupDelay.joinRespRxStart = cdl.getVideoJoinRespRxStart();\n      break;\n\n    case 'client.media-engine.ready':\n      joinTimes.totalMediaJMT = cdl.getTotalMediaJMT();\n      joinTimes.interstitialToMediaOKJMT = cdl.getInterstitialToMediaOKJMT();\n      joinTimes.callInitMediaEngineReady = cdl.getCallInitMediaEngineReady();\n      joinTimes.stayLobbyTime = cdl.getStayLobbyTime();\n      break;\n\n    case 'client.media.tx.start':\n      audioSetupDelay.joinRespTxStart = cdl.getAudioJoinRespTxStart();\n      videoSetupDelay.joinRespTxStart = cdl.getVideoJoinRespTxStart();\n  }\n\n  if (!isEmpty(joinTimes)) {\n    item.eventPayload.event = merge(item.eventPayload.event, {joinTimes});\n  }\n\n  if (!isEmpty(audioSetupDelay)) {\n    item.eventPayload.event = merge(item.eventPayload.event, {audioSetupDelay});\n  }\n\n  if (!isEmpty(videoSetupDelay)) {\n    item.eventPayload.event = merge(item.eventPayload.event, {videoSetupDelay});\n  }\n\n  item.eventPayload.origin = Object.assign(origin, item.eventPayload.origin);\n\n  webex.logger.log(\n    `CallDiagnosticLatencies,prepareDiagnosticMetricItem: ${JSON.stringify({\n      latencies: Object.fromEntries(cdl.latencyTimestamps),\n      event: item,\n    })}`\n  );\n\n  return item;\n};\n\n/**\n * Sets the originTime value(s) before the request/fetch.\n * This function is only useful if you are about to submit a metrics\n * request using pre-built fetch options;\n *\n * @param {any} options\n * @returns {any} the updated options object\n */\nexport const setMetricTimings = (options) => {\n  if (options.body && options.json) {\n    const body = JSON.parse(options.body);\n\n    const now = new Date().toISOString();\n    body.metrics?.forEach((metric) => {\n      if (metric.eventPayload) {\n        // The event will effectively be triggered and sent at the same time.\n        // The existing triggered time is from when the options were built.\n        metric.eventPayload.originTime = {\n          triggered: now,\n          sent: now,\n        };\n      }\n    });\n    options.body = JSON.stringify(body);\n  }\n\n  return options;\n};\n\nexport const extractVersionMetadata = (version: string) => {\n  // extract major and minor version\n  const [majorVersion, minorVersion] = version.split('.');\n\n  return {\n    majorVersion: parseInt(majorVersion, 10),\n    minorVersion: parseInt(minorVersion, 10),\n  };\n};\n\n/**\n * Generates client error codes for specific ice failures\n * that happen when trying to add media in a meeting.\n */\nexport const generateClientErrorCodeForIceFailure = ({\n  signalingState,\n  iceConnected,\n  turnServerUsed,\n  unreachable,\n}: {\n  signalingState: RTCPeerConnection['signalingState'];\n  iceConnected: boolean;\n  turnServerUsed: boolean;\n  unreachable: boolean;\n}) => {\n  let errorCode = ICE_FAILURE_CLIENT_CODE; // default;\n\n  if (signalingState === 'have-local-offer') {\n    errorCode = MISSING_ROAP_ANSWER_CLIENT_CODE;\n  }\n\n  if (signalingState === 'stable' && iceConnected) {\n    errorCode = DTLS_HANDSHAKE_FAILED_CLIENT_CODE;\n  }\n\n  if (signalingState !== 'have-local-offer' && !iceConnected) {\n    if (turnServerUsed) {\n      if (unreachable) {\n        errorCode = ICE_AND_REACHABILITY_FAILED_CLIENT_CODE;\n      } else {\n        errorCode = ICE_FAILED_WITH_TURN_TLS_CLIENT_CODE;\n      }\n    } else {\n      errorCode = ICE_FAILED_WITHOUT_TURN_TLS_CLIENT_CODE;\n    }\n  }\n\n  return errorCode;\n};\n"],"mappings":"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"}