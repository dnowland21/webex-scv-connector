{"version":3,"names":["_common","require","_webexCore","_lodash","precedence","silent","group","groupEnd","error","warn","log","info","debug","trace","levels","exports","_keys","default","filter","level","fallbacks","LOG_TYPES","SDK","CLIENT","SDK_LOG_TYPE_NAME","authTokenKeyPattern","walkAndFilter","object","visited","arguments","length","undefined","includes","push","isArray","map","o","isObject","isString","patterns","containsEmails","test","replace","containsMTID","_i","_Object$entries","_entries","_Object$entries$_i","_slicedToArray2","key","value","_deleteProperty","Logger","WebexPlugin","extend","namespace","derived","cache","fn","getCurrentLevel","client_level","getCurrentClientLevel","session","buffer","type","_default","nextIndex","groupLevel","sdkBuffer","clientBuffer","_len","args","Array","_key2","arg","Error","process","env","NODE_ENV","inBrowser","ret","toString","stack","cloneDeep","shouldPrint","shouldBuffer","config","bufferLogLevel","WEBEX_LOG_LEVEL","webex","internal","device","features","developer","get","clientLevel","formatLogs","options","getDate","_options$diff","diff","clientIndex","sdkIndex","separateLogBuffers","Date","slice","join","version","makeLoggerMethod","impl","neverPrint","alwaysBuffer","wrappedConsoleMethod","logType","clientName","bufferRef","historyLength","clientHistoryLength","filtered","concat","_toConsumableArray2","apply","stringified","item","_typeof2","returnItem","_stringify","_key","e","_console","toPrint","has","unshift","url","console","logDate","toISOString","repeat","deleteCount","splice","reason","forEach","impls","pop","prototype","client_logToBuffer","logToBuffer","_default2"],"sources":["logger.js"],"sourcesContent":["/*!\n * Copyright (c) 2015-2020 Cisco Systems, Inc. See LICENSE file.\n */\n\nimport {inBrowser, patterns} from '@webex/common';\nimport {WebexPlugin} from '@webex/webex-core';\nimport {cloneDeep, has, isArray, isObject, isString} from 'lodash';\n\nconst precedence = {\n  silent: 0,\n  group: 1,\n  groupEnd: 2,\n  error: 3,\n  warn: 4,\n  log: 5,\n  info: 6,\n  debug: 7,\n  trace: 8,\n};\n\nexport const levels = Object.keys(precedence).filter((level) => level !== 'silent');\n\nconst fallbacks = {\n  error: ['log'],\n  warn: ['error', 'log'],\n  info: ['log'],\n  debug: ['info', 'log'],\n  trace: ['debug', 'info', 'log'],\n};\n\nconst LOG_TYPES = {\n  SDK: 'sdk',\n  CLIENT: 'client',\n};\n\nconst SDK_LOG_TYPE_NAME = 'wx-js-sdk';\n\nconst authTokenKeyPattern = /[Aa]uthorization/;\n\n/**\n * Recursively strips \"authorization\" fields from the specified object\n * @param {Object} object\n * @param {Array<mixed>} [visited]\n * @private\n * @returns {Object}\n */\nfunction walkAndFilter(object, visited = []) {\n  if (visited.includes(object)) {\n    // Prevent circular references\n    return object;\n  }\n\n  visited.push(object);\n\n  if (isArray(object)) {\n    return object.map((o) => walkAndFilter(o, visited));\n  }\n  if (!isObject(object)) {\n    if (isString(object)) {\n      if (patterns.containsEmails.test(object)) {\n        return object.replace(patterns.containsEmails, '[REDACTED]');\n      }\n      if (patterns.containsMTID.test(object)) {\n        return object.replace(patterns.containsMTID, '$1[REDACTED]');\n      }\n    }\n\n    return object;\n  }\n\n  for (const [key, value] of Object.entries(object)) {\n    if (authTokenKeyPattern.test(key)) {\n      Reflect.deleteProperty(object, key);\n    } else {\n      object[key] = walkAndFilter(value, visited);\n    }\n  }\n\n  return object;\n}\n\n/**\n * @class\n */\nconst Logger = WebexPlugin.extend({\n  namespace: 'Logger',\n\n  derived: {\n    level: {\n      cache: false,\n      fn() {\n        return this.getCurrentLevel();\n      },\n    },\n    client_level: {\n      cache: false,\n      fn() {\n        return this.getCurrentClientLevel();\n      },\n    },\n  },\n  session: {\n    // for when configured to use single buffer\n    buffer: {\n      type: 'object',\n      default() {\n        return {\n          buffer: [],\n          nextIndex: 0,\n        };\n      },\n    },\n    groupLevel: {\n      type: 'number',\n      default() {\n        return 0;\n      },\n    },\n    // for when configured to use separate buffers\n    sdkBuffer: {\n      type: 'object',\n      default() {\n        return {\n          buffer: [],\n          nextIndex: 0,\n        };\n      },\n    },\n    clientBuffer: {\n      type: 'object',\n      default() {\n        return {\n          buffer: [],\n          nextIndex: 0,\n        };\n      },\n    },\n  },\n\n  /**\n   * Ensures auth headers don't get printed in logs\n   * @param {Array<mixed>} args\n   * @private\n   * @memberof Logger\n   * @returns {Array<mixed>}\n   */\n  filter(...args) {\n    return args.map((arg) => {\n      // WebexHttpError already ensures auth tokens don't get printed, so, no\n      // need to alter it here.\n      if (arg instanceof Error) {\n        // karma logs won't print subclassed errors correctly, so we need\n        // explicitly call their tostring methods.\n        if (process.env.NODE_ENV === 'test' && inBrowser) {\n          let ret = arg.toString();\n\n          ret += 'BEGIN STACK';\n          ret += arg.stack;\n          ret += 'END STACK';\n\n          return ret;\n        }\n\n        return arg;\n      }\n\n      arg = cloneDeep(arg);\n\n      return walkAndFilter(arg);\n    });\n  },\n\n  /**\n   * Determines if the current level allows logs at the specified level to be\n   * printed\n   * @param {string} level\n   * @param {string} type type of log, SDK or client\n   * @private\n   * @memberof Logger\n   * @returns {boolean}\n   */\n  shouldPrint(level, type = LOG_TYPES.SDK) {\n    return (\n      precedence[level] <=\n      precedence[type === LOG_TYPES.SDK ? this.getCurrentLevel() : this.getCurrentClientLevel()]\n    );\n  },\n\n  /**\n   * Determines if the current level allows logs at the specified level to be\n   * put into the log buffer. We're configuring it omit trace and debug logs\n   * because there are *a lot* of debug logs that really don't provide value at\n   * runtime (they're helpful for debugging locally, but really just pollute the\n   * uploaded logs and push useful info out).\n   * @param {string} level\n   * @param {string} type type of log, SDK or client\n   * @private\n   * @memberof Logger\n   * @returns {boolean}\n   */\n  shouldBuffer(level) {\n    return (\n      precedence[level] <=\n      (this.config.bufferLogLevel ? precedence[this.config.bufferLogLevel] : precedence.info)\n    );\n  },\n\n  /**\n   * Indicates the current SDK log level based on env vars, feature toggles, and\n   * user type.\n   * @instance\n   * @memberof Logger\n   * @private\n   * @memberof Logger\n   * @returns {string}\n   */\n  // eslint-disable-next-line complexity\n  getCurrentLevel() {\n    // If a level has been explicitly set via config, alway use it.\n    if (this.config.level) {\n      return this.config.level;\n    }\n\n    if (levels.includes(process.env.WEBEX_LOG_LEVEL)) {\n      return process.env.WEBEX_LOG_LEVEL;\n    }\n\n    // Always use debug-level logging in test mode;\n    if (process.env.NODE_ENV === 'test') {\n      return 'trace';\n    }\n\n    // Use server-side-feature toggles to configure log levels\n    const level =\n      this.webex.internal.device && this.webex.internal.device.features.developer.get('log-level');\n\n    if (level) {\n      if (levels.includes(level)) {\n        return level;\n      }\n    }\n\n    return 'error';\n  },\n\n  /**\n   * Indicates the current client log level based on config, defaults to SDK level\n   * @instance\n   * @memberof Logger\n   * @private\n   * @memberof Logger\n   * @returns {string}\n   */\n  getCurrentClientLevel() {\n    // If a client log level has been explicitly set via config, alway use it.\n    if (this.config.clientLevel) {\n      return this.config.clientLevel;\n    }\n\n    // otherwise default to SDK level\n    return this.getCurrentLevel();\n  },\n\n  /**\n   * Format logs (for upload)\n   *\n   * If separate client, SDK buffers is configured, merge the buffers, if configured\n   *\n   * @instance\n   * @memberof Logger\n   * @public\n   * @memberof Logger\n   * @param {Object} options\n   * @param {boolean} options.diff whether to only format the diff from last call to formatLogs(), false by default\n   * @returns {string} formatted buffer\n   */\n  formatLogs(options = {}) {\n    function getDate(log) {\n      return log[1];\n    }\n    const {diff = false} = options;\n    let buffer = [];\n    let clientIndex = diff ? this.clientBuffer.nextIndex : 0;\n    let sdkIndex = diff ? this.sdkBuffer.nextIndex : 0;\n\n    if (this.config.separateLogBuffers) {\n      // merge the client and sdk buffers\n      // while we have entries in either buffer\n      while (\n        clientIndex < this.clientBuffer.buffer.length ||\n        sdkIndex < this.sdkBuffer.buffer.length\n      ) {\n        // if we have remaining entries in the SDK buffer\n        if (\n          sdkIndex < this.sdkBuffer.buffer.length &&\n          // and we haven't exhausted all the client buffer entries, or SDK date is before client date\n          (clientIndex >= this.clientBuffer.buffer.length ||\n            new Date(getDate(this.sdkBuffer.buffer[sdkIndex])) <=\n              new Date(getDate(this.clientBuffer.buffer[clientIndex])))\n        ) {\n          // then add to the SDK buffer\n          buffer.push(this.sdkBuffer.buffer[sdkIndex]);\n          sdkIndex += 1;\n        }\n        // otherwise if we haven't exhausted all the client buffer entries, add client entry, whether it was because\n        // it was the only remaining entries or date was later (the above if)\n        else if (clientIndex < this.clientBuffer.buffer.length) {\n          buffer.push(this.clientBuffer.buffer[clientIndex]);\n          clientIndex += 1;\n        }\n      }\n      if (diff) {\n        this.clientBuffer.nextIndex = clientIndex;\n        this.sdkBuffer.nextIndex = sdkIndex;\n      }\n    } else if (diff) {\n      buffer = this.buffer.buffer.slice(this.buffer.nextIndex);\n      this.buffer.nextIndex = this.buffer.buffer.length;\n    } else {\n      buffer = this.buffer.buffer;\n    }\n\n    return buffer.join('\\n');\n  },\n});\n\n/**\n * Creates a logger method\n *\n *\n * @param {string} level level to create (info, error, warn, etc.)\n * @param {string} impl the level to use when writing to console\n * @param {string} type type of log, SDK or client\n * @param {bool} neverPrint function never prints to console\n * @param {bool} alwaysBuffer function always logs to log buffer\n * @instance\n * @memberof Logger\n * @private\n * @memberof Logger\n * @returns {function} logger method with specified params\n */\nfunction makeLoggerMethod(level, impl, type, neverPrint = false, alwaysBuffer = false) {\n  // Much of the complexity in the following function is due to a test-mode-only\n  // helper\n  return function wrappedConsoleMethod(...args) {\n    // it would be easier to just pass in the name and buffer here, but the config isn't completely initialized\n    // in Ampersand, even if the initialize method is used to set this up.  so we keep the type to achieve\n    // a sort of late binding to allow retrieving a name from config.\n    const logType = type;\n    const clientName =\n      logType === LOG_TYPES.SDK ? SDK_LOG_TYPE_NAME : this.config.clientName || logType;\n\n    let bufferRef;\n    let historyLength;\n\n    if (this.config.separateLogBuffers) {\n      historyLength = this.config.clientHistoryLength\n        ? this.config.clientHistoryLength\n        : this.config.historyLength;\n      bufferRef = logType === LOG_TYPES.SDK ? this.sdkBuffer : this.clientBuffer;\n    } else {\n      bufferRef = this.buffer;\n      historyLength = this.config.historyLength;\n    }\n\n    try {\n      const shouldPrint = !neverPrint && this.shouldPrint(level, logType);\n      const shouldBuffer = alwaysBuffer || this.shouldBuffer(level);\n\n      if (!shouldBuffer && !shouldPrint) {\n        return;\n      }\n\n      const filtered = [clientName, ...this.filter(...args)];\n      const stringified = filtered.map((item) => {\n        if (item instanceof Error) {\n          return item.toString();\n        }\n        if (typeof item === 'object') {\n          let cache = [];\n          let returnItem;\n          try {\n            returnItem = JSON.stringify(item, (_key, value) => {\n              if (typeof value === 'object' && value !== null) {\n                if (cache.includes(value)) {\n                  // Circular reference found, discard key\n                  return undefined;\n                }\n                // Store value in our collection\n                cache.push(value);\n              }\n\n              return value;\n            });\n          } catch (e) {\n            returnItem = `Failed to stringify: ${item}`;\n          }\n          cache = null;\n\n          return returnItem;\n        }\n\n        return item;\n      });\n\n      if (shouldPrint) {\n        // when logging an object in browsers, we tend to get a dynamic\n        // reference, thus going back to look at the logged value doesn't\n        // necessarily show the state at log time, thus we print the stringified\n        // value.\n        const toPrint = inBrowser ? stringified : filtered;\n\n        /* istanbul ignore if */\n        if (process.env.NODE_ENV === 'test' && has(this, 'webex.internal.device.url')) {\n          toPrint.unshift(this.webex.internal.device.url.slice(-3));\n        }\n        // eslint-disable-next-line no-console\n        console[impl](...toPrint);\n      }\n\n      if (shouldBuffer) {\n        const logDate = new Date();\n\n        stringified.unshift(logDate.toISOString());\n        stringified.unshift('|  '.repeat(this.groupLevel));\n        bufferRef.buffer.push(stringified);\n        if (bufferRef.buffer.length > historyLength) {\n          // we've gone over the buffer limit, trim it down\n          const deleteCount = bufferRef.buffer.length - historyLength;\n\n          bufferRef.buffer.splice(0, deleteCount);\n\n          // and adjust the corresponding buffer index used for log diff uploads\n          bufferRef.nextIndex -= deleteCount;\n          if (bufferRef.nextIndex < 0) {\n            bufferRef.nextIndex = 0;\n          }\n        }\n        if (level === 'group') this.groupLevel += 1;\n        if (level === 'groupEnd' && this.groupLevel > 0) this.groupLevel -= 1;\n      }\n    } catch (reason) {\n      if (!neverPrint) {\n        /* istanbul ignore next */\n        // eslint-disable-next-line no-console\n        console.warn(`failed to execute Logger#${level}`, reason);\n      }\n    }\n  };\n}\n\nlevels.forEach((level) => {\n  let impls = fallbacks[level];\n  let impl = level;\n\n  if (impls) {\n    impls = impls.slice();\n    // eslint-disable-next-line no-console\n    while (!console[impl]) {\n      impl = impls.pop();\n    }\n  }\n\n  // eslint-disable-next-line complexity\n  Logger.prototype[`client_${level}`] = makeLoggerMethod(level, impl, LOG_TYPES.CLIENT);\n  Logger.prototype[level] = makeLoggerMethod(level, impl, LOG_TYPES.SDK);\n});\n\nLogger.prototype.client_logToBuffer = makeLoggerMethod(\n  levels.info,\n  levels.info,\n  LOG_TYPES.CLIENT,\n  true,\n  true\n);\nLogger.prototype.logToBuffer = makeLoggerMethod(\n  levels.info,\n  levels.info,\n  LOG_TYPES.SDK,\n  true,\n  true\n);\n\nexport default Logger;\n"],"mappings":"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"}